<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>çµ±åˆ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼†JSãƒ‡ãƒ¢</title>
    <style>
        body { 
            font-family: sans-serif; 
            max-width: 600px; 
            margin: auto; 
            padding: 20px; 
        }
        textarea, button { 
            width: 100%; 
            padding: 10px; 
            margin-bottom: 10px; 
            box-sizing: border-box; 
        }
        #response, #message { 
            border: 1px solid #ccc; 
            padding: 15px; 
            min-height: 50px; 
            background-color: #f9f9f9; 
            white-space: pre-wrap; 
            margin-bottom: 20px;
        }
        .js-demo-button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        h2 {
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    
    <h1>ğŸ’¡ JavaScriptå‹•ä½œç¢ºèªãƒ‡ãƒ¢</h1>
    
    <p id="message">ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ãªJavaScriptã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
    <button id="actionButton" class="js-demo-button">å‹•ä½œç¢ºèªãƒœã‚¿ãƒ³</button>

    <hr>
    
    <h1>ğŸ¤– AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆFastAPIé€£æºï¼‰</h1>
    <p>è³ªå•ã‚’å…¥åŠ›ã—ã¦ã€ã€Œå¿œç­”ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

    <textarea id="promptInput" placeholder="ã“ã“ã«è³ªå•ã‚’å…¥åŠ›..." rows="4"></textarea>
    <button onclick="generateResponse()">å¿œç­”ã‚’ç”Ÿæˆ</button>

    <h2>AIã‹ã‚‰ã®å¿œç­”</h2>
    <div id="response">ã“ã“ã«AIã‹ã‚‰ã®å¿œç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>

    <script>
        // ===========================================
        // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã®ã‚·ãƒ³ãƒ—ãƒ«ãª JavaScript ãƒ­ã‚¸ãƒƒã‚¯
        // ===========================================
        
        // æ‰‹é † 1: HTMLè¦ç´ ã‚’ ID ã‚’ä½¿ã£ã¦å–å¾—ã™ã‚‹
        const messageElement = document.getElementById('message');
        const buttonElement = document.getElementById('actionButton');

        // æ‰‹é † 2: ãƒœã‚¿ãƒ³ãŒã€Œã‚¯ãƒªãƒƒã‚¯ã€ã•ã‚ŒãŸã¨ãã®å‹•ä½œã‚’å®šç¾©ã™ã‚‹
        buttonElement.addEventListener('click', function() {
            // æ‰‹é † 3: ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹
            messageElement.textContent = 'ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸï¼JavaScriptãŒå‹•ã„ã¦ã„ã¾ã™ï¼';

            // (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) ãƒœã‚¿ãƒ³è‡ªä½“ã®è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹
            buttonElement.style.backgroundColor = 'green';
        });

        // ===========================================
        // 2. FastAPIé€£æºç”¨ã® JavaScript ãƒ­ã‚¸ãƒƒã‚¯
        // ===========================================
        
        // â˜…â˜…â˜… ä¿®æ­£æ¸ˆã¿ï¼šFastAPIã‚µãƒ¼ãƒãƒ¼ã®å…¬é–‹URLã‚’çµ¶å¯¾ãƒ‘ã‚¹ã§æŒ‡å®š â˜…â˜…â˜…
        // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ãŸéš›ã®CORSã‚¨ãƒ©ãƒ¼ãŒå›é¿ã•ã‚Œã¾ã™ã€‚
        const FASTAPI_BASE_URL = 'https://atjmuwnwmtjw-hello.hf.space'; 
        const API_ENDPOINT = FASTAPI_BASE_URL + '/llm/generate';

        async function generateResponse() {
            const prompt = document.getElementById('promptInput').value;
            const responseDiv = document.getElementById('response');
            
            if (!prompt.trim()) {
                responseDiv.textContent = "è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¨­å®š
            responseDiv.textContent = "å¿œç­”ã‚’ç”Ÿæˆä¸­...";

            try {
                // Fetch APIã‚’ä½¿ç”¨ã—ã¦FastAPIã‚µãƒ¼ãƒãƒ¼ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // FastAPIã®Pydanticãƒ¢ãƒ‡ãƒ« (LLMRequest) ã«åˆã‚ã›ãŸJSONãƒœãƒ‡ã‚£ã‚’ä½œæˆ
                    body: JSON.stringify({ 
                        prompt: prompt, 
                        max_length: 1000 
                    })
                });

                if (!response.ok) {
                    // ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è§£æ
                    const errorData = await response.json();
                    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ï¼ˆä¾‹: 500 Internal Server Errorãªã©ï¼‰
                    throw new Error(`API Error: ${response.status} - ${errorData.detail || 'Unknown error'}`);
                }

                // å¿œç­”ã®JSONã‚’è§£æã—ã€textãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—
                const data = await response.json();
                responseDiv.textContent = data.text; // çµæœã‚’HTMLã«åæ˜ 

            } catch (error) {
                console.error('Fetch Error:', error);
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ä¸Šè¨˜ã§throwã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
                responseDiv.textContent = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
            }
        }
    </script>
</body>
</html>